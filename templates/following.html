{% extends "base.html" %}
{% load static %}
{% block main %}
<main class="suggestions-main">
    <!-- Header -->
    <div class="suggestions-header">
        <h1>Following</h1>
        <div class="search-box">
           <form>
            <input type="text" name='search' placeholder="Search friends...">
            <button type="submit">
                <i class="fas fa-search"></i>
            </button>
            </form>
        </div>
    </div>

    <!-- Following List -->
    <div class="follow-list">
        {% if following_users %}
            {% for follow_obj in following_users %}
                <!-- Use 'with' to rename for clarity -->
                {% with following_user=follow_obj.following %}
                <div class="follow-item">
                    <div class="follow-user">
                        {% if following_user.profile.profile_image %}
                            <img src="{{ following_user.profile.profile_image.url }}" class="follow-avatar" alt="User">
                        {% else %}
                            <img src="{% static "test/default-following_user.png" %}" class="follow-avatar" alt="User">
                        {% endif %}
                        <div class="follow-info">
                            <!-- CORRECTED: Use user.username instead of following.user.username -->
                            <a href="{% url 'profile' following_user.username %}" class="follow-username">
                                {{ following_user.username }}
                            </a>
                            <span class="follow-name">
                                {{ following_user.first_name }} {{ following_user.last_name }}
                            </span>
                        </div>
                    </div>
                    
                    
                     {% if following_user.id == user.id %}

                     {% else %}
                        <button class="follow-btn following"
                            data-id="{{ following_user.id }}"
                            id="follow-btn-{{ following_user.id }}">
                            
                            {% if following_user.id in visiting_user_mutuals %}
                                Friends
                            {% elif following_user.id in visiting_user_following %}
                                Following
                            {% elif following_user.id in visiting_user_follower %}
                                Follow back
                            {% else %}
                                Follow
                            {% endif %}
                        </button>
                    {% endif %}
                    
                </div>
                {% endwith %}
            {% endfor %}
        {% else %}
            <div class="no-posts">
                 <i class="fab fa-instagram"></i>
                <h3>No Followings Yet</h3>
            </div>
        {% endif %}
    </div>
</main>
{% endblock main %}