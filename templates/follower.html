{% extends "base.html" %}
{% load static %}
{% block main %}
<main class="suggestions-main">
    <!-- Header -->
    <div class="suggestions-header">
        <h1>Followers</h1>
        <div class="search-box">
            <form>
            <input type="text" name='search' placeholder="Search friends...">
            <button type="submit">
                <i class="fas fa-search"></i>
            </button>
            </form>
        </div>
    </div>

    <!-- Following List -->
    <div class="follow-list">
        {% if followers %}
            {% for follower in followers %}
                <!-- Use 'with' to rename for clarity -->
                {% with follower_user=follower.follower %}
                <div class="follow-item">
                    <div class="follow-user">
                        {% if follower_user.profile.profile_image %}
                            <img src="{{ follower_user.profile.profile_image.url }}" class="follow-avatar" alt="User">
                        {% else %}
                            <img src="{% static "test/default-following_user.png" %}" class="follow-avatar" alt="User">
                        {% endif %}
                        <div class="follow-info">
                            <!-- CORRECTED: Use user.username instead of following.user.username -->
                            <a href="{% url 'profile' follower_user.username %}" class="follow-username">
                                {{ follower_user.username }}
                            </a>
                            <span class="follow-name">
                                {{ follower_user.first_name }} {{ follower_user.last_name }}
                            </span>
                        </div>
                    </div>
                    
                    
                    {% if follower_user.id == user.id %}

                    {% else %}
                        <button class="follow-btn following"
                            data-id="{{ follower_user.id }}"
                            id="follow-btn-{{ follower_user.id }}">
                            
                            {% if follower_user.id in req_mutuals %}
                                Friends
                            {% elif follower_user.id in req_following %}
                                Following
                            {% elif follower_user.id in req_followers %}
                                Follow back
                            {% else %}
                                Follow
                            {% endif %}
                        </button>
                    
                    {% endif %}
                </div>
                {% endwith %}
            {% endfor %}
        {% else %}
            <div class="no-posts">
                 <i class="fab fa-instagram"></i>
                <h3>No Followers Yet</h3>
            </div>
        {% endif %}
    </div>
</main>
{% endblock main %}